Yahoo!.alfredworkflowのメモ

機能：
　Alfred Json Formatを活用してRSSを表示させる

インストール：
　1.alfredworkflowをダウンロード
　2.ファイルをダブルクリックしてワークフローに登録

使い方：
　alfredから"ヤフー"と入力するとRSSの候補出力されるので、続けて入力or選択
　

開発メモ：

悪戦苦闘した部分が多かったのでメモに残しておきます

1.まずは一つのRSSでScriptFilterを作成

　このワークフローには7つのScriptFilterがありますが作りは全て同じ
　まずは『(ヤフー　ゆるネタ)』のコードを見てください
  
　1行目にURLを変数queryに代入していますが、これは、もともとRunScriptでURLをパラメータとして受け取って処理を開始しようとしていた名残です
　RunScriptでAlfredのJsonフォーマットを記述してみたのですが、ScriptFilterでしか使えないのですね

　続いてRSSのURLから必要な要素を取り出しています
　要素の取り出し方はgrepとsedです
　インターネットで検索して適当に選びました

　はじめはxmllintで解析する方法を試したのですが、うまく行きませんでした
　空白があってパースが途切れる感じです

　どうせ空白を取る必要があるのであればと思い、sedとgrepで取り出すことにしました
　インターネットからのコピペなのでオプションやパラメータは吟味していません
　そう、動いたからいいやのノリです

  RSSのtitleタグ、descriptionタグ、linkタグをそれぞれ配列に格納しています
　URLからRSS取得、空白削除、タグ取り出し、タグの内容取り出しという4段階をパイプで繋いでいます
  テスト中に気が付いたのですが、descriptionタグには&lt;や&gt;でaタグが埋め込まれていたので、 
  空白削除の後に&lt;から&gt;に囲まれた部分も削除しました

　ちょっと気になるのが、それぞれのタグごとにcURLを利用しているので無駄なコードになっています
　cURLの結果を変数に入れて、その変数をechoしてからパイプで繋いだのですが、
　なぜか最短一致にならなくなったので変数方式は諦めました（力量不足です）
　
　最後はJSONフォーマットの記述
　はじめはサンプル通りEOBで書いてみました
　ただ、せっかく配列を利用したので、ループ処理で文字列をつなげてみました（線が繋がっているScriptFilterを見てくださいな）
　こちらはEOBではないのですが、最後にechoをしてみたらうまくAlfredに表示させることができました

　兎にも角にも、これでコア部分の完成です
　

2.初めにRSSのカテゴリーを選択させる
　
　AlfredのJsonフォーマットでの出力を2段階で利用したいと思い思考錯誤しました
　ただ、ScriptFilterでしかJsonフォーマットでの出力ができないようでしたので、ScriptFilterを並べるという荒技で解決しました
　具体的にはScriptFilterのキーワードを『ヤフー　〇〇〇〇』とするだけ
　こうすることで、Alfredの機能で、それぞれのRSSが候補として表示されるのです　
　コード作成ではありませんが、工夫次第でやりたいことが実現できるという例かな


背景：
 AlfredのJSONフォーマットのサンプルとしてScriptFilterが準備されていたので、何かに利用できないかと考えたら
 すぐにRSSフィードが思い浮かびました。よくあるニュースサイトのRSSなどをみていたら、ヤフーのRSS一覧を発見。
　https://news.yahoo.co.jp/rss
 下の方にあったみんなの意見という一連のRSSをインタラクティブにAlfredで表現してみました
　もし皆さんがRSSをよく利用するのであれば、RSS xxxをキーワードとしてAlfredでまとめてみてはいかかでしょう
　


　


